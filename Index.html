<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Poblado - Sistema de Ventas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.25);
        }
        
        .product-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .category-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .input-field {
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }
        
        .cart-item {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-left: 4px solid #667eea;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .chart-bar {
            transition: all 0.3s ease;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
            transform: scaleY(1.05);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="hero-section text-white py-16 relative">
        <div class="container mx-auto px-4 text-center relative z-10">
            <div class="flex justify-center mb-6">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/621a1090-46aa-48b0-83f0-6f5fefb9a58d.png" alt="El Poblado store logo featuring a modern shopping cart icon with mountain silhouette in the background, rendered in elegant gold and white colors" class="animate-float" />
            </div>
            <h1 class="text-5xl font-bold mb-4">El Poblado</h1>
            <p class="text-xl opacity-90">Sistema Integral de Ventas e Inventario</p>
        </div>
    </div>

    <div class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center gap-2 py-4">
                <button onclick="showTab('ventas')" class="tab-button px-6 py-3 rounded-lg font-medium bg-gray-200 hover:bg-gray-300 transition-all">
                    Ventas
                </button>
                <button onclick="showTab('inventario')" class="tab-button px-6 py-3 rounded-lg font-medium bg-gray-200 hover:bg-gray-300 transition-all">
                    Inventario
                </button>
                <button onclick="showTab('resumen')" class="tab-button px-6 py-3 rounded-lg font-medium bg-gray-200 hover:bg-gray-300 transition-all">
                    Resumen
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <div id="ventas-tab" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Productos Disponibles</h2>
                        
                        <div class="mb-6">
                            <select id="categoryFilter" class="input-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Todas las categorías</option>
                            </select>
                        </div>
                        
                        <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                    </div>
                </div>
                
                <div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Carrito de Compras</h2>
                        
                        <div id="cart" class="space-y-3 mb-6"></div>
                        
                        <div class="border-t pt-4">
                            <div class="text-xl font-bold mb-4">
                                Total: $<span id="totalAmount">0</span>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Dinero recibido:</label>
                                    <input type="number" id="receivedAmount" class="input-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="0" step="0.01">
                                </div>
                                
                                <div class="text-lg font-semibold">
                                    Cambio: $<span id="changeAmount">0</span>
                                </div>
                                
                                <button onclick="processSale()" class="btn-primary w-full py-3 text-white font-semibold rounded-lg">
                                    Procesar Venta
                                </button>
                                
                                <button onclick="clearCart()" class="w-full py-3 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition-all">
                                    Limpiar Carrito
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="inventario-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-gray-800">Gestión de Inventario</h2>
                    <button onclick="showAddProductForm()" class="btn-primary px-6 py-3 text-white font-semibold rounded-lg">
                        Agregar Producto
                    </button>
                </div>
                
                <div id="addProductForm" class="hidden bg-gray-50 rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Agregar Nuevo Producto</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <input type="text" id="newProductName" placeholder="Nombre del producto" class="input-field px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="number" id="newProductPrice" placeholder="Precio" step="0.01" class="input-field px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="number" id="newProductStock" placeholder="Stock inicial" class="input-field px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <input type="text" id="newProductCategory" placeholder="Categoría" class="input-field px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div class="flex gap-4 mt-4">
                        <button onclick="addProduct()" class="btn-primary px-6 py-3 text-white font-semibold rounded-lg">
                            Agregar
                        </button>
                        <button onclick="hideAddProductForm()" class="px-6 py-3 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition-all">
                            Cancelar
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold">Producto</th>
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold">Precio</th>
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold">Stock</th>
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold">Categoría</th>
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="resumen-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Estadísticas Generales</h2>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="stats-card rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold">$<span id="totalSales">0</span></div>
                                <div class="text-sm opacity-90">Ventas Totales</div>
                            </div>
                            
                            <div class="stats-card rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold">$<span id="netProfit">0</span></div>
                                <div class="text-sm opacity-90">Ganancia Neta</div>
                            </div>
                            
                            <div class="stats-card rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold">$<span id="restockAmount">0</span></div>
                                <div class="text-sm opacity-90">Monto a Reponer (Total)</div>
                            </div>
                            
                            <div class="stats-card rounded-lg p-4 text-center">
                                <div class="text-2xl font-bold"><span id="lowStockProducts">0</span></div>
                                <div class="text-sm opacity-90">Productos con Bajo Stock</div>
                            </div>
                        </div>
                         <div class="text-lg font-bold mt-4">Monto Total a Reponer: $<span id="totalRestockAmount">0</span></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Desglose de Monto a Reponer</h3>
                        <div id="restockByCategoryList" class="space-y-2">
                            </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Productos con Bajo Stock (≤ 5)</h3>
                        <div id="lowStockList" class="space-y-2"></div>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Ventas por Día (Últimos 7 días)</h3>
                        <div id="dailySalesChart" class="h-64"></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Historial de Ventas Hoy</h3>
                        <div id="todaySales" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let products = [
            { id: 1, name: 'Coca Cola 350ml', price: 2.50, stock: 50, category: 'Bebidas', cost: 1.50 },
            { id: 2, name: 'Pepsi 350ml', price: 2.30, stock: 45, category: 'Bebidas', cost: 1.40 },
            { id: 3, name: 'Agua 500ml', price: 1.00, stock: 100, category: 'Bebidas', cost: 0.50 },
            { id: 4, name: 'Papas Fritas', price: 3.50, stock: 30, category: 'Snacks', cost: 2.00 },
            { id: 5, name: 'Galletas Oreo', price: 2.80, stock: 25, category: 'Snacks', cost: 1.80 },
            { id: 6, name: 'Chocolate Snickers', price: 1.50, stock: 40, category: 'Dulces', cost: 1.00 },
            { id: 7, name: 'Chicles Trident', price: 1.20, stock: 60, category: 'Dulces', cost: 0.80 },
            { id: 8, name: 'Pan Integral', price: 3.00, stock: 20, category: 'Panadería', cost: 2.00 },
            // Nuevos productos para probar las subcategorías de reposición
            { id: 9, name: 'Cerveza Pilsener 330ml', price: 2.00, stock: 30, category: 'Bebidas', cost: 1.20 },
            { id: 10, name: 'Cerveza Club 330ml', price: 2.20, stock: 25, category: 'Bebidas', cost: 1.30 },
            { id: 11, name: 'Whisky Old Times 750ml', price: 25.00, stock: 15, category: 'Licores', cost: 15.00 },
            { id: 12, name: 'Foco LED 220V', price: 5.00, stock: 40, category: 'Electricidad', cost: 3.00 }
        ];
        
        let cart = [];
        let sales = [];
        let dailySales = {};
        
        // Función para mostrar/ocultar tabs
        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remover clase active de todos los botones
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Marcar botón como activo
            event.target.classList.add('active');
            
            // Actualizar contenido según el tab
            if (tabName === 'ventas') {
                loadProducts();
                updateCart();
            } else if (tabName === 'inventario') {
                loadInventoryTable();
            } else if (tabName === 'resumen') {
                updateSummaryStats();
                loadDailySalesChart();
                loadTodaySales();
            }
        }
        
        // Función para cargar productos
        function loadProducts() {
            const productList = document.getElementById('productList');
            const categoryFilter = document.getElementById('categoryFilter');
            const selectedCategory = categoryFilter.value;
            
            // Actualizar opciones de categoría
            const categories = [...new Set(products.map(p => p.category))];
            categoryFilter.innerHTML = '<option value="">Todas las categorías</option>';
            categories.forEach(cat => {
                categoryFilter.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            categoryFilter.value = selectedCategory;
            
            // Filtrar productos
            const filteredProducts = selectedCategory ? 
                products.filter(p => p.category === selectedCategory) : 
                products;
            
            productList.innerHTML = '';
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card rounded-lg p-4 cursor-pointer';
                
                const stockStatus = product.stock <= 5 ? 'text-red-600 font-semibold' : 
                                  product.stock <= 10 ? 'text-yellow-600 font-semibold' : 
                                  'text-green-600';
                
                productCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-gray-800">${product.name}</h3>
                        <span class="category-badge text-white text-xs px-2 py-1 rounded-full">${product.category}</span>
                    </div>
                    <div class="text-lg font-bold text-blue-600 mb-1">$${product.price.toFixed(2)}</div>
                    <div class="${stockStatus}">Stock: ${product.stock}</div>
                `;
                
                if (product.stock > 0) {
                    productCard.onclick = () => addToCart(product.id);
                } else {
                    productCard.style.opacity = '0.5';
                    productCard.style.cursor = 'not-allowed';
                }
                
                productList.appendChild(productCard);
            });
        }
        
        // Función para agregar al carrito
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                }
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }
            
            updateCart();
        }
        
        // Función para actualizar carrito
        function updateCart() {
            const cartElement = document.getElementById('cart');
            const totalElement = document.getElementById('totalAmount');
            const receivedInput = document.getElementById('receivedAmount');
            const changeElement = document.getElementById('changeAmount');
            
            cartElement.innerHTML = '';
            let total = 0;
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item rounded-lg p-3';
                
                cartItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="font-semibold">${item.name}</div>
                            <div class="text-sm text-gray-600">$${item.price.toFixed(2)} x ${item.quantity}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="changeQuantity(${item.id}, -1)" class="w-6 h-6 bg-gray-300 rounded text-center text-sm hover:bg-gray-400 transition-all">-</button>
                            <span class="font-semibold">${item.quantity}</span>
                            <button onclick="changeQuantity(${item.id}, 1)" class="w-6 h-6 bg-gray-300 rounded text-center text-sm hover:bg-gray-400 transition-all">+</button>
                            <button onclick="removeFromCart(${item.id})" class="w-6 h-6 bg-red-500 text-white rounded text-center text-sm hover:bg-red-600 transition-all">×</button>
                        </div>
                    </div>
                    <div class="text-right font-bold mt-2">$${(item.price * item.quantity).toFixed(2)}</div>
                `;
                
                cartElement.appendChild(cartItem);
                total += item.price * item.quantity;
            });
            
            totalElement.textContent = total.toFixed(2);
            
            // Calcular cambio
            const received = parseFloat(receivedInput.value) || 0;
            const change = Math.max(0, received - total);
            changeElement.textContent = change.toFixed(2);
        }
        
        // Función para cambiar cantidad
        function changeQuantity(productId, delta) {
            const item = cart.find(item => item.id === productId);
            const product = products.find(p => p.id === productId);
            
            if (item && product) {
                const newQuantity = item.quantity + delta;
                
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else if (newQuantity <= product.stock) {
                    item.quantity = newQuantity;
                }
                
                updateCart();
            }
        }
        
        // Función para remover del carrito
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart();
        }
        
        // Función para limpiar carrito
        function clearCart() {
            cart = [];
            document.getElementById('receivedAmount').value = '';
            updateCart();
        }
        
        // Función para procesar venta
        function processSale() {
            if (cart.length === 0) {
                alert('El carrito está vacío');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const received = parseFloat(document.getElementById('receivedAmount').value) || 0;
            
            if (received < total) {
                alert('El dinero recibido es insuficiente');
                return;
            }
            
            // Actualizar stock
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                }
            });
            
            // Registrar venta
            const sale = {
                id: Date.now(),
                timestamp: new Date(),
                items: [...cart],
                total: total,
                received: received,
                change: received - total
            };
            
            sales.push(sale);
            
            // Actualizar ventas diarias
            const today = new Date().toDateString();
            if (!dailySales[today]) {
                dailySales[today] = 0;
            }
            dailySales[today] += total;
            
            alert(`Venta procesada exitosamente!\nTotal: $${total.toFixed(2)}\nCambio: $${(received - total).toFixed(2)}`);
            
            clearCart();
            loadProducts();
        }
        
        // Función para mostrar formulario de agregar producto
        function showAddProductForm() {
            document.getElementById('addProductForm').classList.remove('hidden');
        }
        
        // Función para ocultar formulario de agregar producto
        function hideAddProductForm() {
            document.getElementById('addProductForm').classList.add('hidden');
            // Limpiar campos
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductPrice').value = '';
            document.getElementById('newProductStock').value = '';
            document.getElementById('newProductCategory').value = '';
        }
        
        // Función para agregar producto
        function addProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const price = parseFloat(document.getElementById('newProductPrice').value);
            const stock = parseInt(document.getElementById('newProductStock').value);
            const category = document.getElementById('newProductCategory').value.trim();
            
            if (!name || !price || !stock || !category) {
                alert('Por favor complete todos los campos');
                return;
            }
            
            const newProduct = {
                id: Math.max(...products.map(p => p.id), 0) + 1,
                name: name,
                price: price,
                stock: stock,
                category: category,
                cost: price * 0.6 // Asumimos 40% de ganancia, entonces el costo es 60% del precio de venta
            };
            
            products.push(newProduct);
            hideAddProductForm();
            loadInventoryTable();
            
            alert('Producto agregado exitosamente');
        }
        
        // Función para cargar tabla de inventario
        function loadInventoryTable() {
            const tableBody = document.getElementById('inventoryTable');
            tableBody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-all';
                
                const stockClass = product.stock <= 5 ? 'text-red-600 font-semibold' :
                                  product.stock <= 10 ? 'text-yellow-600 font-semibold' :
                                  'text-green-600';
                
                row.innerHTML = `
                    <td class="border border-gray-200 px-4 py-3">
                        <input type="text" value="${product.name}" onchange="updateProduct(${product.id}, 'name', this.value)" 
                               class="w-full border-none bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-2 py-1">
                    </td>
                    <td class="border border-gray-200 px-4 py-3">
                        <input type="number" value="${product.price}" step="0.01" onchange="updateProduct(${product.id}, 'price', parseFloat(this.value))" 
                               class="w-full border-none bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-2 py-1">
                    </td>
                    <td class="border border-gray-200 px-4 py-3 ${stockClass}">
                        <input type="number" value="${product.stock}" onchange="updateProduct(${product.id}, 'stock', parseInt(this.value))" 
                               class="w-full border-none bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-2 py-1">
                    </td>
                    <td class="border border-gray-200 px-4 py-3">
                        <input type="text" value="${product.category}" onchange="updateProduct(${product.id}, 'category', this.value)" 
                               class="w-full border-none bg-transparent focus:bg-white focus:border focus:border-blue-300 rounded px-2 py-1">
                    </td>
                    <td class="border border-gray-200 px-4 py-3">
                        <button onclick="deleteProduct(${product.id})" class="btn-danger px-3 py-1 text-white text-sm rounded hover:opacity-80 transition-all">
                            Eliminar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Función para actualizar producto
        function updateProduct(productId, field, value) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product[field] = value;
                
                // Si es cambio de precio, actualizar costo asumiendo 40% ganancia
                if (field === 'price') {
                    product.cost = value * 0.6; // El costo sigue siendo el 60% del nuevo precio de venta
                }
            }
        }
        
        // Función para eliminar producto
        function deleteProduct(productId) {
            if (confirm('¿Está seguro de eliminar este producto?')) {
                products = products.filter(p => p.id !== productId);
                loadInventoryTable();
            }
        }
        
        // Función para actualizar estadísticas de resumen
        function updateSummaryStats() {
            const totalSales = sales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Calculamos el costo total de todos los productos vendidos en TODAS las ventas
            let totalCost = 0;
            // Objeto para acumular el costo por cada subcategoría de reposición
            let restockCategories = {
                'Cerveza': 0,
                'Old Times': 0,
                '220V': 0,
                'Otros': 0 // Para productos que no encajan en las categorías específicas
            };

            sales.forEach(sale => {
                sale.items.forEach(item => {
                    const product = products.find(p => p.id === item.id);
                    if (product && product.cost) {
                        const itemCost = product.cost * item.quantity;
                        totalCost += itemCost;

                        // Asignar el costo a la subcategoría de reposición
                        const productNameLower = product.name.toLowerCase();
                        const productCategoryLower = product.category.toLowerCase();

                        if (productNameLower.includes('cerveza') || productCategoryLower.includes('cerveza')) {
                            restockCategories['Cerveza'] += itemCost;
                        } else if (productNameLower.includes('old times')) {
                            restockCategories['Old Times'] += itemCost;
                        } else if (productNameLower.includes('220v')) {
                            restockCategories['220V'] += itemCost;
                        } else {
                            restockCategories['Otros'] += itemCost;
                        }
                    }
                });
            });

            const netProfit = totalSales - totalCost; // Esta es la ganancia

            // El MONTO A REPONER AHORA SERÁ EL COSTO TOTAL DE LOS PRODUCTOS VENDIDOS
            const restockAmount = totalCost; 
            
            document.getElementById('totalSales').textContent = totalSales.toFixed(2);
            document.getElementById('netProfit').textContent = netProfit.toFixed(2);
            
            // Actualizamos AMBOS spans con el valor del costo total
            document.getElementById('restockAmount').textContent = restockAmount.toFixed(2); 
            document.getElementById('totalRestockAmount').textContent = restockAmount.toFixed(2); 
            
            // La sección de productos con bajo stock sigue funcionando por sí sola
            const lowStockProducts = products.filter(p => p.stock <= 5);
            document.getElementById('lowStockProducts').textContent = lowStockProducts.length;
            
            // Mostrar lista de productos con bajo stock (sin cambiar la lógica de esta sección)
            const lowStockList = document.getElementById('lowStockList');
            lowStockList.innerHTML = '';
            
            if (lowStockProducts.length === 0) {
                lowStockList.innerHTML = '<div class="text-green-600 font-semibold">Todos los productos tienen stock suficiente</div>';
            } else {
                lowStockProducts.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'bg-red-50 border border-red-200 rounded-lg p-3';
                    item.innerHTML = `
                        <div class="font-semibold text-red-800">${product.name}</div>
                        <div class="text-sm text-red-600">Stock actual: ${product.stock} unidades</div>
                        <div class="text-sm text-red-600">Costo de ${product.stock} unidades: $${(product.stock * product.cost).toFixed(2)}</div>
                    `;
                    lowStockList.appendChild(item);
                });
            }

            // Mostrar el desglose del monto a reponer por subcategoría
            const restockByCategoryList = document.getElementById('restockByCategoryList');
            restockByCategoryList.innerHTML = ''; // Limpiar antes de añadir

            for (const category in restockCategories) {
                if (restockCategories[category] > 0 || category === 'Otros') { // Mostrar "Otros" incluso si es 0, o cualquier categoría si tiene valor
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'bg-blue-50 border border-blue-200 rounded-lg p-3 flex justify-between items-center';
                    categoryItem.innerHTML = `
                        <div class="font-semibold text-blue-800">${category}</div>
                        <div class="font-bold text-blue-600">$${restockCategories[category].toFixed(2)}</div>
                    `;
                    restockByCategoryList.appendChild(categoryItem);
                }
            }
        }
        
        // Función para cargar gráfico de ventas diarias
        function loadDailySalesChart() {
            const chartContainer = document.getElementById('dailySalesChart');
            chartContainer.innerHTML = '';
            
            // Obtener últimos 7 días
            const days = [];
            const values = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateKey = date.toDateString();
                
                days.push(date.toLocaleDateString('es', { weekday: 'short', day: 'numeric' }));
                values.push(dailySales[dateKey] || 0);
            }
            
            const maxValue = Math.max(...values, 100); // Mínimo 100 para el gráfico
            
            // Crear gráfico simple con barras
            const chartHTML = days.map((day, index) => {
                const height = (values[index] / maxValue) * 100;
                return `
                    <div class="flex flex-col items-center">
                        <div class="w-8 bg-gray-200 rounded" style="height: 180px; display: flex; align-items: flex-end;">
                            <div class="chart-bar w-full bg-gradient-to-t from-blue-500 to-purple-600 rounded" style="height: ${height}%; min-height: 4px;"></div>
                        </div>
                        <div class="text-xs mt-2 text-center">${day}</div>
                        <div class="text-xs font-semibold text-gray-600">$${values[index].toFixed(0)}</div>
                    </div>
                `;
            }).join('');
            
            chartContainer.innerHTML = `
                <div class="flex justify-around items-end h-full">
                    ${chartHTML}
                </div>
            `;
        }
        
        // Función para cargar ventas de hoy
        function loadTodaySales() {
            const todaySalesContainer = document.getElementById('todaySales');
            const today = new Date().toDateString();
            const todaySales = sales.filter(sale => sale.timestamp.toDateString() === today);
            
            todaySalesContainer.innerHTML = '';
            
            if (todaySales.length === 0) {
                todaySalesContainer.innerHTML = '<div class="text-gray-500 text-center py-4">No hay ventas registradas hoy</div>';
                return;
            }
            
            todaySales.reverse().forEach(sale => {
                const saleItem = document.createElement('div');
                saleItem.className = 'bg-gray-50 rounded-lg p-3 border';
                
                const itemsList = sale.items.map(item => `${item.name} x${item.quantity}`).join(', ');
                
                saleItem.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="text-sm font-semibold">${sale.timestamp.toLocaleTimeString()}</div>
                            <div class="text-sm text-gray-600">${itemsList}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-green-600">$${sale.total.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">${sale.items.length} productos</div>
                        </div>
                    </div>
                `;
                
                todaySalesContainer.appendChild(saleItem);
            });
        }
        
        // Event listeners
        document.getElementById('categoryFilter').addEventListener('change', loadProducts);
        document.getElementById('receivedAmount').addEventListener('input', updateCart);
        
        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer el tab "Ventas" como activo al cargar la página
            // y asegurar que su botón correspondiente tenga la clase 'active'
            document.querySelector('.tab-button').classList.add('active');
            showTab('ventas'); // Llama a showTab para cargar la vista inicial de ventas
            
            // Simular algunas ventas para demo (opcional, para ver datos en el resumen)
            const today = new Date();
            const todayKey = today.toDateString();
            dailySales[todayKey] = 45.80;
            
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            dailySales[yesterday.toDateString()] = 67.50;
            
            // Agregar ventas de ejemplo que reflejen tus subcategorías
            sales.push({
                id: 1,
                timestamp: new Date(), 
                items: [
                    { id: 9, name: 'Cerveza Pilsener 330ml', price: 2.00, quantity: 2 }, // Costo: 2 * 1.20 = 2.40
                    { id: 10, name: 'Cerveza Club 330ml', price: 2.20, quantity: 1 } // Costo: 1 * 1.30 = 1.30
                ],
                total: 6.20, // 2*2.00 + 1*2.20 = 4.00 + 2.20 = 6.20
                received: 10.00,
                change: 3.80
            });
            sales.push({
                id: 2,
                timestamp: new Date(), 
                items: [
                    { id: 11, name: 'Whisky Old Times 750ml', price: 25.00, quantity: 1 } // Costo: 1 * 15.00 = 15.00
                ],
                total: 25.00,
                received: 30.00,
                change: 5.00
            });
            sales.push({
                id: 3,
                timestamp: new Date(), 
                items: [
                    { id: 12, name: 'Foco LED 220V', price: 5.00, quantity: 2 } // Costo: 2 * 3.00 = 6.00
                ],
                total: 10.00,
                received: 10.00,
                change: 0.00
            });
            sales.push({
                id: 4,
                timestamp: new Date(), 
                items: [
                    { id: 1, name: 'Coca Cola 350ml', price: 2.50, quantity: 1 }, // Costo: 1 * 1.50 = 1.50
                    { id: 4, name: 'Papas Fritas', price: 3.50, quantity: 1 } // Costo: 1 * 2.00 = 2.00
                ],
                total: 6.00,
                received: 10.00,
                change: 4.00
            });
        });
    </script>
</body>
</html>
